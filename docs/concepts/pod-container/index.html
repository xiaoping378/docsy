<!doctype html><html lang=zh-cn class=no-js>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.91.2">
<meta name=robots content="index, follow">
<link rel="shortcut icon" href=/docsy/favicons/favicon.ico>
<link rel=apple-touch-icon href=/docsy/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=icon type=image/png href=/docsy/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/docsy/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/docsy/favicons/android-36x36.png sizes=36x36>
<link rel=icon type=image/png href=/docsy/favicons/android-48x48.png sizes=48x48>
<link rel=icon type=image/png href=/docsy/favicons/android-72x72.png sizes=72x72>
<link rel=icon type=image/png href=/docsy/favicons/android-96x96.png sizes=96x96>
<link rel=icon type=image/png href=/docsy/favicons/android-144x144.png sizes=144x144>
<link rel=icon type=image/png href=/docsy/favicons/android-192x192.png sizes=192x192>
<title>为容器和 Pods 分配 CPU 资源 | xxx项目Wiki</title>
<meta name=description content="

">
<meta property="og:title" content="为容器和 Pods 分配 CPU 资源">
<meta property="og:description" content="本页面展示如何为容器设置 CPU request（请求） 和 CPU limit（限制）。 容器使用的 CPU 不能超过所配置的限制。 如果系统有空闲的 CPU 时间，则可以保证给容器分配其所请求数量的 CPU 资源。
集群中的每个节点必须至少有 1 个 CPU 可用才能运行本任务中的示例。
本页的一些步骤要求你在集群中运行 metrics-server 服务。如果你的集群中已经有正在运行的 metrics-server 服务，可以跳过这些步骤。
如果你正在运行，请运行以下命令启用 metrics-server：
minikube addons enable metrics-server 查看 metrics-server（或者其他资源度量 API metrics.k8s.io 服务提供者）是否正在运行， 请键入以下命令：
kubectl get apiservices 如果资源指标 API 可用，则会输出将包含一个对 metrics.k8s.io 的引用。
NAME v1beta1.metrics.k8s.io 创建一个名字空间 创建一个，以便将 本练习中创建的资源与集群的其余部分资源隔离。
kubectl create namespace cpu-example 指定 CPU 请求和 CPU 限制 要为容器指定 CPU 请求，请在容器资源清单中包含 resources: requests 字段。 要指定 CPU 限制，请包含 resources:limits。
在本练习中，你将创建一个具有一个容器的 Pod。容器将会请求 0.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://xiaoping378.github.io/docsy/docs/concepts/pod-container/"><meta property="article:section" content="docs">
<meta property="article:modified_time" content="2022-01-21T22:20:50+08:00"><meta property="og:site_name" content="xxx项目Wiki">
<meta itemprop=name content="为容器和 Pods 分配 CPU 资源">
<meta itemprop=description content="本页面展示如何为容器设置 CPU request（请求） 和 CPU limit（限制）。 容器使用的 CPU 不能超过所配置的限制。 如果系统有空闲的 CPU 时间，则可以保证给容器分配其所请求数量的 CPU 资源。
集群中的每个节点必须至少有 1 个 CPU 可用才能运行本任务中的示例。
本页的一些步骤要求你在集群中运行 metrics-server 服务。如果你的集群中已经有正在运行的 metrics-server 服务，可以跳过这些步骤。
如果你正在运行，请运行以下命令启用 metrics-server：
minikube addons enable metrics-server 查看 metrics-server（或者其他资源度量 API metrics.k8s.io 服务提供者）是否正在运行， 请键入以下命令：
kubectl get apiservices 如果资源指标 API 可用，则会输出将包含一个对 metrics.k8s.io 的引用。
NAME v1beta1.metrics.k8s.io 创建一个名字空间 创建一个，以便将 本练习中创建的资源与集群的其余部分资源隔离。
kubectl create namespace cpu-example 指定 CPU 请求和 CPU 限制 要为容器指定 CPU 请求，请在容器资源清单中包含 resources: requests 字段。 要指定 CPU 限制，请包含 resources:limits。
在本练习中，你将创建一个具有一个容器的 Pod。容器将会请求 0.">
<meta itemprop=dateModified content="2022-01-21T22:20:50+08:00">
<meta itemprop=wordCount content="461">
<meta itemprop=keywords content><meta name=twitter:card content="summary">
<meta name=twitter:title content="为容器和 Pods 分配 CPU 资源">
<meta name=twitter:description content="本页面展示如何为容器设置 CPU request（请求） 和 CPU limit（限制）。 容器使用的 CPU 不能超过所配置的限制。 如果系统有空闲的 CPU 时间，则可以保证给容器分配其所请求数量的 CPU 资源。
集群中的每个节点必须至少有 1 个 CPU 可用才能运行本任务中的示例。
本页的一些步骤要求你在集群中运行 metrics-server 服务。如果你的集群中已经有正在运行的 metrics-server 服务，可以跳过这些步骤。
如果你正在运行，请运行以下命令启用 metrics-server：
minikube addons enable metrics-server 查看 metrics-server（或者其他资源度量 API metrics.k8s.io 服务提供者）是否正在运行， 请键入以下命令：
kubectl get apiservices 如果资源指标 API 可用，则会输出将包含一个对 metrics.k8s.io 的引用。
NAME v1beta1.metrics.k8s.io 创建一个名字空间 创建一个，以便将 本练习中创建的资源与集群的其余部分资源隔离。
kubectl create namespace cpu-example 指定 CPU 请求和 CPU 限制 要为容器指定 CPU 请求，请在容器资源清单中包含 resources: requests 字段。 要指定 CPU 限制，请包含 resources:limits。
在本练习中，你将创建一个具有一个容器的 Pod。容器将会请求 0.">
<link rel=preload href=/docsy/scss/main.min.704093cd1a56f37fd00dc35c7125fced09d88d60c92d59965b30c8c0eeef1cd5.css as=style>
<link href=/docsy/scss/main.min.704093cd1a56f37fd00dc35c7125fced09d88d60c92d59965b30c8c0eeef1cd5.css rel=stylesheet integrity>
<script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script>
</head>
<body class=td-page>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class=navbar-brand href=/docsy/>
<span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88"><circle r="44" cy="44" cx="44" fill="#e21d38"/><path stroke="null" d="M43.02 48.22c21.63 1.8 29.95 7.75 29.56 15.88-.4 4.36-4.57 8.52-9.92 8.93-6.34.4-9.33-2.2-11.1-4.97-1.6-2.57-3.38-5.16-5.17-7.94-.4-.8-1.2-.2-1.8.2-1.4 1.2-2.6 2.58-3.8 3.78-.7.78-.5 1.4-.3 1.98 1.2 2.78 2.4 5.56 3.6 8.13 1.9 1.2 10.8 2.8 17.4 2.2 4.6-.4 10.1-2.2 14.9-5.5 4.6-3.6 7.9-8.3 8.5-16.1.2-4.7-.6-9.6-4.78-14.2s-11.3-8.3-25.8-9.3c.8-2.3 1.4-4.5 2.2-6.73 8.75.4 16.5 1 23.04 1.8.6-2.5.8-4.95 1.4-7.36l-1.8-2.1c-3.36-.42-6.55-1.22-10.1-1.62-4.55-.6-9.3-1-14.46-1.2-3.4 9.57-7.4 21.64-11.6 34.3m-5.8-37.1c-1.6.0-3.76.4-7.33 1.2-7.73 2.2-17.24 7.54-18.24 16.45-.2 1.4-.2 3-.4 4.3l-6.13.6C5 35.6 5 37.2 4.8 39c2-.2 3.97-.2 6.15-.4-.4 9.36.0 18.7.8 27.37.2 1.4.2 2.6.2 3.4-.2.82-1.6 1.22-3.57 1.22l2.6 3.1c7.56 1.4 17.1 2.4 27.18 2.6v-3c-5.97-.4-8.7-1.2-9.1-2.4-.4-1-.4-2.4-.6-3.8-.4-9.1-.6-19.1-.4-29.2 3.43.0 6.75.0 10.17-.2 1.8-.8 3.4-1.6 5-2.4v-3.4c-5.17.0-10.13.2-15.1.2l.6-11.9c.2-2.6 1.98-4.4 3.57-4.4 2.77-.2 5.33.98 7.92 2.17 1.4.6 2.8 1.4 4.18 2 .6.2 1.4.4 2-.23.8-.97 1.6-1.97 2.38-2.76.4-.6.2-1 0-1.2l-5.38-4c-1-.8-2.8-.8-4.4-.8-.6-.2-1.2.0-1.8.0" fill="#fff"/><text x="80" y="85" font-size="14" font-face="sans-serif" fill="#e21d38">®</text></svg></span><span class="text-uppercase font-weight-bold">xxx项目Wiki</span>
</a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/docsy/about/><span>About</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link active" href=/docsy/docs/><span class=active>Documentation</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/docsy/blog/><span>Blog</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/docsy/community/><span>Community</span></a>
</li>
</ul>
</div>
<div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; 站内搜索…" aria-label=站内搜索… autocomplete=off>
</div>
</nav>
</header>
<div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
<div id=td-sidebar-menu class=td-sidebar__inner>
<form class="td-sidebar__search d-flex align-items-center">
<input type=search class="form-control td-search-input" placeholder="&#xf002; 站内搜索…" aria-label=站内搜索… autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation">
</button>
</form>
<nav class="collapse td-sidebar-nav" id=td-section-nav>
<ul class="td-sidebar-nav__section pr-md-3 ul-0">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsy-docs-li>
<a href=/docsy/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docsy-docs><span>Documentation</span></a>
<ul class=ul-1>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsy-docs-overview-li>
<a href=/docsy/docs/overview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsy-docs-overview><span>Overview</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsy-docs-getting-started-li>
<a href=/docsy/docs/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsy-docs-getting-started><span>Getting Started</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsy-docs-getting-started-example-page-li>
<a href=/docsy/docs/getting-started/example-page/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsy-docs-getting-started-example-page><span>Example Page</span></a>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsy-docs-examples-li>
<a href=/docsy/docs/examples/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsy-docs-examples><span>Examples</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsy-docs-concepts-li>
<a href=/docsy/docs/concepts/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsy-docs-concepts><span>Concepts</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docsy-docs-concepts-pod-container-li>
<a href=/docsy/docs/concepts/pod-container/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-docsy-docs-concepts-pod-container><span class=td-sidebar-nav-active-item>为容器和 Pods 分配 CPU 资源</span></a>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsy-docs-tasks-li>
<a href=/docsy/docs/tasks/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsy-docs-tasks><span>Core Tasks</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsy-docs-tasks-beds-li>
<a href=/docsy/docs/tasks/beds/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsy-docs-tasks-beds><span>Bed and Chair Metrics</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsy-docs-tasks-porridge-li>
<a href=/docsy/docs/tasks/porridge/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsy-docs-tasks-porridge><span>Porridge Assessment</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsy-docs-tasks-task-li>
<a href=/docsy/docs/tasks/task/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsy-docs-tasks-task><span>Another Task</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-docsy-docs-tasks-ponycopters-li>
<a href=/docsy/docs/tasks/ponycopters/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsy-docs-tasks-ponycopters><span>Working with Ponycopters</span></a>
<ul class="ul-3 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsy-docs-tasks-ponycopters-configuring-ponycopters-li>
<a href=/docsy/docs/tasks/ponycopters/configuring-ponycopters/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsy-docs-tasks-ponycopters-configuring-ponycopters><span>Configuring Ponycopters</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsy-docs-tasks-ponycopters-launching-ponycopters-li>
<a href=/docsy/docs/tasks/ponycopters/launching-ponycopters/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsy-docs-tasks-ponycopters-launching-ponycopters><span>Launching Ponycopters</span></a>
</li>
</ul>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsy-docs-tutorials-li>
<a href=/docsy/docs/tutorials/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsy-docs-tutorials><span>Tutorials</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsy-docs-tutorials-multi-bear-li>
<a href=/docsy/docs/tutorials/multi-bear/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsy-docs-tutorials-multi-bear><span>Multi-Bear Domicile Setup</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsy-docs-tutorials-tutorial2-li>
<a href=/docsy/docs/tutorials/tutorial2/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsy-docs-tutorials-tutorial2><span>Another Tutorial</span></a>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsy-docs-reference-li>
<a href=/docsy/docs/reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsy-docs-reference><span>Reference</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsy-docs-reference-parameter-reference-li>
<a href=/docsy/docs/reference/parameter-reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsy-docs-reference-parameter-reference><span>Parameter Reference</span></a>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsy-docs-contribution-guidelines-li>
<a href=/docsy/docs/contribution-guidelines/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsy-docs-contribution-guidelines><span>Contribution Guidelines</span></a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
<aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
<a href=https://github.com/google/docsy-example/tree/master/content/zh-cn/docs/Concepts/pod-container.md class=td-page-meta--view target=_blank rel=noopener><i class="fa fa-file-alt fa-fw"></i> 查看页面源码</a>
<a href=https://github.com/google/docsy-example/edit/master/content/zh-cn/docs/Concepts/pod-container.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> 编辑此页</a>
<a href="https://github.com/google/docsy-example/new/master/content/zh-cn/docs/Concepts/pod-container.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> 添加子页面</a>
<a href="https://github.com/google/docsy-example/issues/new?title=%e4%b8%ba%e5%ae%b9%e5%99%a8%e5%92%8c%20Pods%20%e5%88%86%e9%85%8d%20CPU%20%e8%b5%84%e6%ba%90" class=td-page-meta--issue target=_blank rel=noopener><i class="fab fa-github fa-fw"></i> 提交文档问题</a>
<a href=https://github.com/google/docsy/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fas fa-tasks fa-fw"></i> 提交项目问题</a>
<a id=print href=https://xiaoping378.github.io/docsy/docs/concepts/_print/><i class="fa fa-print fa-fw"></i> 整节打印</a>
</div>
<div class=td-toc><nav id=TableOfContents>
<ul>
<li><a href=#创建一个名字空间>创建一个名字空间</a></li>
<li><a href=#指定-cpu-请求和-cpu-限制>指定 CPU 请求和 CPU 限制</a></li>
<li><a href=#cpu-units>CPU 单位 </a></li>
<li><a href=#设置超过节点能力的-cpu-请求>设置超过节点能力的 CPU 请求</a></li>
<li><a href=#如果不指定-cpu-限制>如果不指定 CPU 限制</a></li>
<li><a href=#如果你设置了-cpu-限制但未设置-cpu-请求>如果你设置了 CPU 限制但未设置 CPU 请求</a></li>
<li><a href=#cpu-请求和限制的初衷>CPU 请求和限制的初衷</a></li>
<li><a href=#清理>清理</a>
<ul>
<li><a href=#针对应用开发者>针对应用开发者</a></li>
<li><a href=#针对集群管理员>针对集群管理员</a></li>
</ul>
</li>
</ul>
</nav></div>
</aside>
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<nav aria-label=breadcrumb class=td-breadcrumbs>
<ol class=breadcrumb>
<li class=breadcrumb-item>
<a href=https://xiaoping378.github.io/docsy/docs/>Documentation</a>
</li>
<li class=breadcrumb-item>
<a href=https://xiaoping378.github.io/docsy/docs/concepts/>Concepts</a>
</li>
<li class="breadcrumb-item active" aria-current=page>
<a href=https://xiaoping378.github.io/docsy/docs/concepts/pod-container/>为容器和 Pods 分配 CPU 资源</a>
</li>
</ol>
</nav>
<div class=td-content>
<h1>为容器和 Pods 分配 CPU 资源</h1>
<header class=article-meta>
</header>
<p>本页面展示如何为容器设置 CPU <em>request（请求）</em> 和 CPU <em>limit（限制）</em>。
容器使用的 CPU 不能超过所配置的限制。
如果系统有空闲的 CPU 时间，则可以保证给容器分配其所请求数量的 CPU 资源。</p>
<p>集群中的每个节点必须至少有 1 个 CPU 可用才能运行本任务中的示例。</p>
<p>本页的一些步骤要求你在集群中运行
<a href=https://github.com/kubernetes-sigs/metrics-server>metrics-server</a>
服务。如果你的集群中已经有正在运行的 metrics-server 服务，可以跳过这些步骤。</p>
<p>如果你正在运行，请运行以下命令启用 metrics-server：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>minikube addons <span style=color:#a2f>enable</span> metrics-server
</code></pre></div>
<p>查看 metrics-server（或者其他资源度量 API <code>metrics.k8s.io</code> 服务提供者）是否正在运行，
请键入以下命令：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get apiservices
</code></pre></div>
<p>如果资源指标 API 可用，则会输出将包含一个对 <code>metrics.k8s.io</code> 的引用。</p>
<pre tabindex=0><code>NAME
v1beta1.metrics.k8s.io
</code></pre>
<h2 id=创建一个名字空间>创建一个名字空间</h2>
<p>创建一个，以便将
本练习中创建的资源与集群的其余部分资源隔离。</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create namespace cpu-example
</code></pre></div>
<h2 id=指定-cpu-请求和-cpu-限制>指定 CPU 请求和 CPU 限制</h2>
<p>要为容器指定 CPU 请求，请在容器资源清单中包含 <code>resources: requests</code> 字段。
要指定 CPU 限制，请包含 <code>resources:limits</code>。</p>
<p>在本练习中，你将创建一个具有一个容器的 Pod。容器将会请求 0.5 个 CPU，而且最多限制使用 1 个 CPU。
这是 Pod 的配置文件：</p>
<p>配置文件的 <code>args</code> 部分提供了容器启动时的参数。
<code>-cpus "2"</code> 参数告诉容器尝试使用 2 个 CPU。</p>
<p>创建 Pod：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl apply -f https://k8s.io/examples/pods/resource/cpu-request-limit.yaml --namespace<span style=color:#666>=</span>cpu-example
</code></pre></div>
<p>验证所创建的 Pod 处于 Running 状态</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get pod cpu-demo --namespace<span style=color:#666>=</span>cpu-example
</code></pre></div>
<p>查看显示关于 Pod 的详细信息：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get pod cpu-demo --output<span style=color:#666>=</span>yaml --namespace<span style=color:#666>=</span>cpu-example
</code></pre></div>
<p>输出显示 Pod 中的一个容器的 CPU 请求为 500 milli CPU，并且 CPU 限制为 1 个 CPU。</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;1&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span>500m<span style=color:#bbb>
</span></code></pre></div>
<p>使用 <code>kubectl top</code> 命令来获取该 Pod 的度量值数据：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl top pod cpu-demo --namespace<span style=color:#666>=</span>cpu-example
</code></pre></div>
<p>此示例输出显示 Pod 使用的是 974 milliCPU，即略低于 Pod 配置中指定的 1 个 CPU 的限制。</p>
<pre tabindex=0><code>NAME                        CPU(cores)   MEMORY(bytes)
cpu-demo                    974m         &lt;something&gt;
</code></pre>
<p>回想一下，通过设置 <code>-cpu "2"</code>，你将容器配置为尝试使用 2 个 CPU，
但是容器只被允许使用大约 1 个 CPU。
容器的 CPU 用量受到限制，因为该容器正尝试使用超出其限制的 CPU 资源。</p>
<p>CPU 使用率低于 1.0 的另一种可能的解释是，节点可能没有足够的 CPU 资源可用。
回想一下，此练习的先决条件需要你的节点至少具有 1 个 CPU 可用。
如果你的容器在只有 1 个 CPU 的节点上运行，则容器无论为容器指定的 CPU 限制如何，
都不能使用超过 1 个 CPU。</p>
<h2 id=cpu-units>CPU 单位 </h2>
<p>CPU 资源以 <em>CPU</em> 单位度量。Kubernetes 中的一个 CPU 等同于：</p>
<ul>
<li>1 个 AWS vCPU</li>
<li>1 个 GCP核心</li>
<li>1 个 Azure vCore</li>
<li>裸机上具有超线程能力的英特尔处理器上的 1 个超线程</li>
</ul>
<p>小数值是可以使用的。一个请求 0.5 CPU 的容器保证会获得请求 1 个 CPU 的容器的 CPU 的一半。
你可以使用后缀 <code>m</code> 表示毫。例如 <code>100m</code> CPU、100 milliCPU 和 0.1 CPU 都相同。
精度不能超过 1m。</p>
<p>CPU 请求只能使用绝对数量，而不是相对数量。0.1 在单核、双核或 48 核计算机上的 CPU 数量值是一样的。</p>
<p>删除 Pod：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl delete pod cpu-demo --namespace<span style=color:#666>=</span>cpu-example
</code></pre></div>
<h2 id=设置超过节点能力的-cpu-请求>设置超过节点能力的 CPU 请求</h2>
<p>CPU 请求和限制与都与容器相关，但是我们可以考虑一下 Pod 具有对应的 CPU 请求和限制这样的场景。
Pod 对 CPU 用量的请求等于 Pod 中所有容器的请求数量之和。
同样，Pod 的 CPU 资源限制等于 Pod 中所有容器 CPU 资源限制数之和。</p>
<p>Pod 调度是基于资源请求值来进行的。
仅在某节点具有足够的 CPU 资源来满足 Pod CPU 请求时，Pod 将会在对应节点上运行：</p>
<p>在本练习中，你将创建一个 Pod，该 Pod 的 CPU 请求对于集群中任何节点的容量而言都会过大。
下面是 Pod 的配置文件，其中有一个容器。容器请求 100 个 CPU，这可能会超出集群中任何节点的容量。</p>
<p>创建 Pod：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl apply -f https://k8s.io/examples/pods/resource/cpu-request-limit-2.yaml --namespace<span style=color:#666>=</span>cpu-example
</code></pre></div>
<p>查看该 Pod 的状态：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get pod cpu-demo-2 --namespace<span style=color:#666>=</span>cpu-example
</code></pre></div>
<p>输出显示 Pod 状态为 Pending。也就是说，Pod 未被调度到任何节点上运行，
并且 Pod 将无限期地处于 Pending 状态：</p>
<pre tabindex=0><code>NAME         READY     STATUS    RESTARTS   AGE
cpu-demo-2   0/1       Pending   0          7m
</code></pre>
<p>查看有关 Pod 的详细信息，包含事件：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl describe pod cpu-demo-2 --namespace<span style=color:#666>=</span>cpu-example
</code></pre></div>
<p>输出显示由于节点上的 CPU 资源不足，无法调度容器：</p>
<pre tabindex=0><code>Events:
  Reason                        Message
  ------                        -------
  FailedScheduling      No nodes are available that match all of the following predicates:: Insufficient cpu (3).
</code></pre>
<p>删除你的 Pod：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl delete pod cpu-demo-2 --namespace<span style=color:#666>=</span>cpu-example
</code></pre></div>
<h2 id=如果不指定-cpu-限制>如果不指定 CPU 限制</h2>
<p>如果你没有为容器指定 CPU 限制，则会发生以下情况之一：</p>
<ul>
<li>
<p>容器在可以使用的 CPU 资源上没有上限。因而可以使用所在节点上所有的可用 CPU 资源。</p>
</li>
<li>
<p>容器在具有默认 CPU 限制的名字空间中运行，系统会自动为容器设置默认限制。
集群管理员可以使用
<a href=/docs/reference/generated/kubernetes-api/0.0/#limitrange-v1-core/>LimitRange</a>
指定 CPU 限制的默认值。</p>
</li>
</ul>
<h2 id=如果你设置了-cpu-限制但未设置-cpu-请求>如果你设置了 CPU 限制但未设置 CPU 请求</h2>
<p>如果你为容器指定了 CPU 限制值但未为其设置 CPU 请求，Kubernetes 会自动为其
设置与 CPU 限制相同的 CPU 请求值。类似的，如果容器设置了内存限制值但未设置
内存请求值，Kubernetes 也会为其设置与内存限制值相同的内存请求。</p>
<h2 id=cpu-请求和限制的初衷>CPU 请求和限制的初衷</h2>
<p>通过配置你的集群中运行的容器的 CPU 请求和限制，你可以有效利用集群上可用的 CPU 资源。
通过将 Pod CPU 请求保持在较低水平，可以使 Pod 更有机会被调度。
通过使 CPU 限制大于 CPU 请求，你可以完成两件事：</p>
<ul>
<li>Pod 可能会有突发性的活动，它可以利用碰巧可用的 CPU 资源。</li>
<li>Pod 在突发负载期间可以使用的 CPU 资源数量仍被限制为合理的数量。</li>
</ul>
<h2 id=清理>清理</h2>
<p>删除名称空间：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl delete namespace cpu-example
</code></pre></div>
<h3 id=针对应用开发者>针对应用开发者</h3>
<ul>
<li><a href=/zh/docs/tasks/configure-pod-container/assign-memory-resource/>将内存资源分配给容器和 Pod</a></li>
<li><a href=/zh/docs/tasks/configure-pod-container/quality-service-pod/>配置 Pod 服务质量</a></li>
</ul>
<h3 id=针对集群管理员>针对集群管理员</h3>
<ul>
<li><a href=/zh/docs/tasks/administer-cluster/manage-resources/memory-default-namespace/>配置名称空间的默认内存请求和限制</a></li>
<li><a href=/zh/docs/tasks/administer-cluster/manage-resources/cpu-default-namespace/>为名字空间配置默认 CPU 请求和限制</a></li>
<li><a href=/zh/docs/tasks/administer-cluster//manage-resources/memory-constraint-namespace/>为名字空间配置最小和最大内存限制</a></li>
<li><a href=/zh/docs/tasks/administer-cluster/manage-resources/cpu-constraint-namespace/>为名字空间配置最小和最大 CPU 约束</a></li>
<li><a href=/zh/docs/tasks/administer-cluster/manage-resources/quota-memory-cpu-namespace/>为名字空间配置内存和 CPU 配额</a></li>
<li><a href=/zh/docs/tasks/administer-cluster/manage-resources/quota-pod-namespace/>为名字空间配置 Pod 配额</a></li>
<li><a href=/zh/docs/tasks/administer-cluster/quota-api-object/>配置 API 对象的配额</a></li>
</ul>
<div class="text-muted mt-5 pt-3 border-top">
最后修改 January 21, 2022: <a href=https://github.com/google/docsy-example/commit/06e1920cbaa3825312a76ccc0ba904ce07e18571>test gh-pages (06e1920)</a>
</div>
</div>
</main>
</div>
</div>
<footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class=row>
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list">
<a class=text-white target=_blank rel=noopener href=https://example.org/mail aria-label="User mailing list">
<i class="fa fa-envelope"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter>
<a class=text-white target=_blank rel=noopener href=https://example.org/twitter aria-label=Twitter>
<i class="fab fa-twitter"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow">
<a class=text-white target=_blank rel=noopener href=https://example.org/stack aria-label="Stack Overflow">
<i class="fab fa-stack-overflow"></i>
</a>
</li>
</ul>
</div>
<div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank rel=noopener href=https://github.com/google/docsy aria-label=GitHub>
<i class="fab fa-github"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack>
<a class=text-white target=_blank rel=noopener href=https://example.org/slack aria-label=Slack>
<i class="fab fa-slack"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list">
<a class=text-white target=_blank rel=noopener href=https://example.org/mail aria-label="Developer mailing list">
<i class="fa fa-envelope"></i>
</a>
</li>
</ul>
</div>
<div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class=text-white>&copy; 2022 xxx项目组 保留所有权利</small>
<small class=ml-1><a href=# target=_blank rel=noopener>隐私政策</a></small>
</div>
</div>
</div>
</footer>
</div>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/docsy/js/tabpane-persist.js></script>
<script src=/docsy/js/main.min.8ab8f81ff7e1454d30024cd6f956d4d341c3a97e2a673f988065f2ee4e147922.js integrity="sha256-irj4H/fhRU0wAkzW+VbU00HDqX4qZz+YgGXy7k4UeSI=" crossorigin=anonymous></script>
</body>
</html>